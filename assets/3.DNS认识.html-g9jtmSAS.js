import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,a as e,o as a}from"./app-D1zlwylF.js";const l="/assets/%E5%9F%9F%E5%90%8D%E8%A7%84%E5%88%99-BKMd4ZSy.jpg",t="/assets/DNS%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B-DV-OoiEx.jpg",r={};function h(p,s){return a(),n("div",null,s[0]||(s[0]=[e('<h2 id="一、域名和-dns-解析" tabindex="-1"><a class="header-anchor" href="#一、域名和-dns-解析"><span>一、域名和 DNS 解析</span></a></h2><p>域名的规则：<code>time.geekbang.org</code> 在这个域名中，最后面的 <code>org</code> 是顶级域名，中间的 <code>geekbang</code> 是二级域名，最左边的 <code>time</code> 则是三级域名。</p><img src="'+l+`" style="zoom:50%;"><ul><li>点（<code>.</code>） 是所有域名的根，也就是所有域名都以点作为后缀。在域名解析过程中，所有域名都以点结束</li></ul><p>域名解析服务（DNS），对应的服务器就是域名服务器，网络协议则是 DNS 协议。DNS 协议在 TCP/IP 栈中属于应用层，传输基于 UDP 和 TCP（UDP居多），并且域名服务器一般监听在端口 53 上</p><p>域名解析其实也是用递归的方式（从顶级开始，依次类推），发送给每个层级的域名服务器，直到得到解析结果。递归查询的过程 DNS 服务器会完成，我们需要配置一个可以的 DNS 服务器。通常，每级 DNS 服务器，都会有最近解析记录的缓存。当缓存命中时，直接用缓存中的记录即可。如果缓存过期或者不存在，才会递归查询。</p><p>系统配置 DNS 服务器：<code>cat /etc/resolv.conf </code></p><p>DNS 服务通过资源记录的方式，来管理所有数据，它支持 A、CNAME、MX、NS、PTR 等多种类型的记录。比如：</p><ul><li>A 记录，用来把域名转换成 IP 地址；当访问某个网址时，就需要通过 DNS 的 A 记录，查询该域名对应的 IP 地址，然后通过该 IP 来访问 Web 服务</li><li>CNAME 记录，用来创建别名；</li><li>而 NS 记录，则表示该域名对应的域名服务器地址。</li></ul><h3 id="_1-dns-访问过程" tabindex="-1"><a class="header-anchor" href="#_1-dns-访问过程"><span>1. DNS 访问过程</span></a></h3><p>通过 nslookup 命令就可以查询到这个域名的 A 记录。他的 IP 地址为：39.106.233.17</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nslookup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> time.geekbang.org</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 域名服务器及端口信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Server:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    114.114.114.114</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Address:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  114.114.114.114#53</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 非权威查询结果</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Non-authoritative</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> answer:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Name:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  time.geekbang.org</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Address:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 39.106.233.17</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 开启 nslookup 的调试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nslookup</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -debug</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> time.geekbang.org</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 使用 time 查看命令执行时间</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nslookup</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> time.geekbang.org</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于 <code>114.114.114.114</code> 并不是直接管理 <code>time.geekbang.org</code> 的域名服务器，所以查询结果是非权威的。</p><p>如果没有命中缓存，DNS 查询是一个递归过程，可以使用常见的 DNS 解析工具 dig 展示递归查询的整个过程。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># +trace表示开启跟踪查询</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># +nodnssec表示禁止DNS安全扩展</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dig</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +trace</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +nodnssec</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> time.geekbang.org</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> DiG</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 9.11.3-1ubuntu1.3-Ubuntu</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> +trace</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +nodnssec</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> time.geekbang.org</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">;; global options: +cmd</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  m.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  a.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  i.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  d.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  g.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  l.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  c.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  b.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  h.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  e.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  k.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  j.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.      322086  IN  NS  f.root-servers.net.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">;; Received 239 bytes from 114.114.114.114#53(114.114.114.114) in 1340 ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">org.      172800  IN  NS  a0.org.afilias-nst.info.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">org.      172800  IN  NS  a2.org.afilias-nst.info.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">org.      172800  IN  NS  b0.org.afilias-nst.org.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">org.      172800  IN  NS  b2.org.afilias-nst.org.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">org.      172800  IN  NS  c0.org.afilias-nst.info.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">org.      172800  IN  NS  d0.org.afilias-nst.org.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">;; Received 448 bytes from 198.97.190.53#53(h.root-servers.net) in 708 ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">geekbang.org.    86400  IN  NS  dns9.hichina.com.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">geekbang.org.    86400  IN  NS  dns10.hichina.com.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">;; Received 96 bytes from 199.19.54.1#53(b0.org.afilias-nst.org) in 1833 ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">time.geekbang.org.  600  IN  A  39.106.233.176</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">;; Received 62 bytes from 140.205.41.16#53(dns10.hichina.com) in 4 ms</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如上的输出，包括四部分：</p><ul><li>第一部分，是从 114.114.114.114 查到的一些根域名服务器（.）的 NS 记录</li><li>第二部分，是从 NS 记录结果中选一个（<a href="http://h.root-servers.net" target="_blank" rel="noopener noreferrer">h.root-servers.net</a>），并查询顶级域名 org. 的 NS 记录</li><li>第三部分，是从 org. 的 NS 记录中选择一个（<a href="http://b0.org.afilias-nst.org" target="_blank" rel="noopener noreferrer">b0.org.afilias-nst.org</a>），并查询二级域名 <a href="http://geekbang.org" target="_blank" rel="noopener noreferrer">geekbang.org</a>. 的 NS 服务器</li><li>最后一部分，就是从 <a href="http://geekbang.org" target="_blank" rel="noopener noreferrer">geekbang.org</a>. 的 NS 服务器（<a href="http://dns10.hichina.com" target="_blank" rel="noopener noreferrer">dns10.hichina.com</a>）查询最终主机 <a href="http://time.geekbang.org" target="_blank" rel="noopener noreferrer">time.geekbang.org</a>. 的 A 记录</li></ul><img src="`+t+`" style="zoom:50%;"><h3 id="_2-局域网内部的主机进行域名解析" tabindex="-1"><a class="header-anchor" href="#_2-局域网内部的主机进行域名解析"><span>2. 局域网内部的主机进行域名解析</span></a></h3><p>局域网内部的主机名和 IP 地址的映射关系，可以写入本机的 <code>/etc/hosts</code> 文件中。这样指定的主机名就可以在本地直接找到目标 IP</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/hosts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">127.0.0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   localhost</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> localhost.localdomain</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         localhost6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> localhost6.localdomain6</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">192.168.0.100</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> domain.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者还可以在内网中，搭建自定义的 DNS 服务器，专门解析内网中的域名。而内网 DNS 服务器，一般还会设置一个或多个上游 DNS 服务器，用来解析外网的域名。</p><h3 id="_3-dns-缓存" tabindex="-1"><a class="header-anchor" href="#_3-dns-缓存"><span>3. DNS 缓存</span></a></h3><p>如果不使用 DNS 缓存，每次查询都要请求 DNS 服务器。<code>dnsmasq</code> 是最常用的 DNS 缓存服务之一，还经常作为 DHCP 服务来使用。</p><h3 id="_4-dns-优化方法" tabindex="-1"><a class="header-anchor" href="#_4-dns-优化方法"><span>4. DNS 优化方法</span></a></h3><ul><li>对 DNS 解析的结果进行缓存。缓存是最有效的方法，但要注意，一旦缓存过期，还是要去 DNS 服务器重新获取新记录。不过，这对大部分应用程序来说都是可接受的。</li><li>对 DNS 解析的结果进行预取。这是浏览器等 Web 应用中最常用的方法，也就是说，不等用户点击页面上的超链接，浏览器就会在后台自动解析域名，并把结果缓存起来。</li><li>使用 HTTPDNS 取代常规的 DNS 解析。这是很多移动应用会选择的方法，特别是如今域名劫持普遍存在，使用 HTTP 协议绕过链路中的 DNS 服务器，就可以避免域名劫持的问题。</li><li>基于 DNS 的全局负载均衡（GSLB）。这不仅为服务提供了负载均衡和高可用的功能，还可以根据用户的位置，返回距离最近的 IP 地址。</li></ul>`,26)]))}const o=i(r,[["render",h],["__file","3.DNS认识.html.vue"]]),c=JSON.parse('{"path":"/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%86%85%E6%A0%B8%E5%8E%9F%E7%90%86/3.DNS%E8%AE%A4%E8%AF%86.html","title":"3.DNS认识","lang":"zh-CN","frontmatter":{"title":"3.DNS认识","date":"2023-01-19T11:11:41.000Z","tags":["linux"],"description":"一、域名和 DNS 解析 域名的规则：time.geekbang.org 在这个域名中，最后面的 org 是顶级域名，中间的 geekbang 是二级域名，最左边的 time 则是三级域名。 点（.） 是所有域名的根，也就是所有域名都以点作为后缀。在域名解析过程中，所有域名都以点结束 域名解析服务（DNS），对应的服务器就是域名服务器，网络协议则是 D...","head":[["meta",{"property":"og:url","content":"https://noahyz.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%86%85%E6%A0%B8%E5%8E%9F%E7%90%86/3.DNS%E8%AE%A4%E8%AF%86.html"}],["meta",{"property":"og:site_name","content":"noahyz的博客"}],["meta",{"property":"og:title","content":"3.DNS认识"}],["meta",{"property":"og:description","content":"一、域名和 DNS 解析 域名的规则：time.geekbang.org 在这个域名中，最后面的 org 是顶级域名，中间的 geekbang 是二级域名，最左边的 time 则是三级域名。 点（.） 是所有域名的根，也就是所有域名都以点作为后缀。在域名解析过程中，所有域名都以点结束 域名解析服务（DNS），对应的服务器就是域名服务器，网络协议则是 D..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"noahyz"}],["meta",{"property":"article:tag","content":"linux"}],["meta",{"property":"article:published_time","content":"2023-01-19T11:11:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"3.DNS认识\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-01-19T11:11:41.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"noahyz\\",\\"url\\":\\"/about-the-author/\\"}]}"]]},"headers":[{"level":2,"title":"一、域名和 DNS 解析","slug":"一、域名和-dns-解析","link":"#一、域名和-dns-解析","children":[{"level":3,"title":"1. DNS 访问过程","slug":"_1-dns-访问过程","link":"#_1-dns-访问过程","children":[]},{"level":3,"title":"2. 局域网内部的主机进行域名解析","slug":"_2-局域网内部的主机进行域名解析","link":"#_2-局域网内部的主机进行域名解析","children":[]},{"level":3,"title":"3. DNS 缓存","slug":"_3-dns-缓存","link":"#_3-dns-缓存","children":[]},{"level":3,"title":"4. DNS 优化方法","slug":"_4-dns-优化方法","link":"#_4-dns-优化方法","children":[]}]}],"git":{},"readingTime":{"minutes":4.57,"words":1370},"filePathRelative":"计算机网络/内核原理/3.DNS认识.md","localizedDate":"2023年1月19日","excerpt":"<h2>一、域名和 DNS 解析</h2>\\n<p>域名的规则：<code>time.geekbang.org</code> 在这个域名中，最后面的 <code>org</code> 是顶级域名，中间的 <code>geekbang</code> 是二级域名，最左边的 <code>time</code> 则是三级域名。</p>\\n\\n<ul>\\n<li>点（<code>.</code>） 是所有域名的根，也就是所有域名都以点作为后缀。在域名解析过程中，所有域名都以点结束</li>\\n</ul>\\n<p>域名解析服务（DNS），对应的服务器就是域名服务器，网络协议则是 DNS 协议。DNS 协议在 TCP/IP 栈中属于应用层，传输基于 UDP 和 TCP（UDP居多），并且域名服务器一般监听在端口 53 上</p>","autoDesc":true}');export{o as comp,c as data};
