import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as e}from"./app-D1zlwylF.js";const l={};function p(h,s){return e(),a("div",null,s[0]||(s[0]=[n(`<p>linux下 c/c++ 编程最常见的就是错误就是段错误了，本文来分析一下段错误为什么产生？产生的原因以及如何处理。</p><h2 id="_1-段错误介绍" tabindex="-1"><a class="header-anchor" href="#_1-段错误介绍"><span>1. 段错误介绍</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>A segmentation fault (often shortened to segfault) is a particular error condition that can occur during the operation of computer software. In short, a segmentation fault occurs when a program attempts to access a memory location that it is not allowed to access, or attempts to access a memory location in a way that is not allowed (e.g., attempts to write to a read-only location, or to overwrite part of the operating system). Systems based on processors like the Motorola 68000 tend to refer to these events as Address or Bus errors.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Segmentation is one approach to memory management and protection in the operating system. It has been superseded by paging for most purposes, but much of the terminology of segmentation is still used, &quot;segmentation fault&quot; being an example. Some operating systems still have segmentation at some logical level although paging is used as the main memory management policy.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>On Unix-like operating systems, a process that accesses invalid memory receives the SIGSEGV signal. On Microsoft Windows, a process that accesses invalid memory receives the STATUS_ACCESS_VIOLATION exception.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分段错误(通常简称段错误)是计算机软件运行过程中可能出现的一种特殊的错误情况。简而言之,出现段错误当一个程序试图访问不允许访问的内存位置,或试图访问一个内存位置的方式是不允许的(例如,试图写一个只读的位置,或覆盖操作系统的一部分)。基于像摩托罗拉68000处理器的系统往往将这些事件称为地址或总线错误。</p><p>分段是操作系统中内存管理和保护的一种方法。在大多数情况下，它已经被分页所取代，但是分段的许多术语仍然被使用，“分段故障”就是一个例子。尽管分页被用作主要的内存管理策略，但一些操作系统在某些逻辑级别上仍然有分段。</p><p>在类unix操作系统上，访问无效内存的进程接收SIGSEGV信号。在Microsoft Windows上，访问无效内存的进程会收到status_access_违例异常。</p><h2 id="_2-为什么产生段错误" tabindex="-1"><a class="header-anchor" href="#_2-为什么产生段错误"><span>2. 为什么产生段错误</span></a></h2><h4 id="_2-1-访问不存在的内存地址" tabindex="-1"><a class="header-anchor" href="#_2-1-访问不存在的内存地址"><span>2.1 访问不存在的内存地址</span></a></h4><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" data-title="c++" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-访问不允许访问的地址" tabindex="-1"><a class="header-anchor" href="#_2-2-访问不允许访问的地址"><span>2.2 访问不允许访问的地址</span></a></h4><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" data-title="c++" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3-写只读的内存地址" tabindex="-1"><a class="header-anchor" href="#_2-3-写只读的内存地址"><span>2.3 写只读的内存地址</span></a></h4><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" data-title="c++" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ptr </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">strcpy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(ptr,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;TEST&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-4-栈溢出" tabindex="-1"><a class="header-anchor" href="#_2-4-栈溢出"><span>2.4 栈溢出</span></a></h4><p>一般多出现于递归函数，或使用栈空间过量。</p><p>还有很多其他原因</p><h2 id="_3-查看段错误信息" tabindex="-1"><a class="header-anchor" href="#_3-查看段错误信息"><span>3. 查看段错误信息</span></a></h2><h4 id="_3-1-dmesg" tabindex="-1"><a class="header-anchor" href="#_3-1-dmesg"><span>3.1 dmesg</span></a></h4><p>这个命令用来检查和控制内核的环形缓冲区，其实就是在检查 /var/log/demsg 日志。默认操作就是显示所有来自于内核缓冲区空间的消息。而段错误来自于内核的报错，因此也会写入到这个日志中。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">执行</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> demsg</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 之后</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">结果：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[7612059.013222] test[10997]: segfault at 4005a0 ip 00000000004004fd sp 00007ffdc00a0370 error 7 in test[400000+1000]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[7612082.776055] test[11162]: segfault at 4005a0 ip 00000000004004fd sp 00007fffbe060180 error 7 in test[400000+1000]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到断错误发生的二进制文件名称、引起段错误发生的内存地址、指令指针地址、堆栈指针地址、错误代码、错误原因等等信息。</p><h4 id="_3-2-分析产生的-core-文件" tabindex="-1"><a class="header-anchor" href="#_3-2-分析产生的-core-文件"><span>3.2 分析产生的 core 文件</span></a></h4><p>使用 gcc/g++ 在编译的时候加上 -g 选项，使生成的二进制文件中加入可以用于 gdb 调试的信息。</p><p>linux 生成 core 文件，需要打开生成 core 文件的选项</p><h5 id="_3-2-1-查看core文件大小-ulimit-a-或者-ulimit-c。" tabindex="-1"><a class="header-anchor" href="#_3-2-1-查看core文件大小-ulimit-a-或者-ulimit-c。"><span>3.2.1 查看core文件大小：ulimit -a 或者 ulimit -c。</span></a></h5><ol><li><p>core file size</p><p>unlimited: core 文件的大小不受限制</p><p>0: 程序出错时不会产生core文件</p><p>1024: 代表1024k，core文件超过该大小就不能生成了</p></li><li><p>设置core文件大小：ulimit -c filesize</p></li><li><p>程序奔溃的时候生成的core文件大小即为程序运行时占用的内存大小，如果发生堆栈溢出，则会占用更大的内存</p></li></ol><h5 id="_3-2-2-设置core文件的名称和文件路径" tabindex="-1"><a class="header-anchor" href="#_3-2-2-设置core文件的名称和文件路径"><span>3.2.2 设置core文件的名称和文件路径</span></a></h5><p>​ 默认生成路径：在可执行文件运行命令的同一路径下</p><p>​ 默认生成名字：默认名字为core，新的core文件会覆盖旧的core文件</p><ol><li><p>设置pid作为文件扩展名</p><p>echo “1” &gt; /proc/sys/kernel/core_uses_pid</p><p>或者 sysctl -w kernel.core_uses_pid=1 kernel.core_uses_pid=1</p><p>其中：0代表不使用pid作为扩展名，1代表使用</p></li><li><p>控制core文件保存位置和文件名格式</p><p>修改文件命名：echo &quot;/corefile/core-%e-%p-%t&quot; &gt; /proc/sys/kernel/core_pattern</p><p>或者：sysctl -w kernel.core_pattern=/corefile/core.%e.%p.%s.%E</p><p>上面命令将core文件统一生成到 /corefile 目录下。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">参数列表</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%p</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> insert</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pid</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> into</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> filename</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 添加pid</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">进程id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%u</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> insert</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> current</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> uid</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> into</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> filename</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 添加当前uid</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">用户id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%g</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> insert</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> current</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gid</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> into</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> filename</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 添加当前gid</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">用户组id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> insert</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> signal</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> that</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> caused</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> coredump</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> into</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> filename</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 添加导致产生core的信号</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%t</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> insert</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> UNIX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> that</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> coredump</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> occurred</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> into</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> filename</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 添加core文件生成时的unix时间</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%h</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> insert</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> hostname</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> where</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> coredump</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> happened</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> into</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> filename</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 添加主机名</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> insert</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> coredumping</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> executable</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> into</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> filename</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 添加导致产生core的命令名</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>接下里可以使用 gdb 来调试生成的 core 文件。</p><h4 id="_3-3-使用-objdump-查看汇编代码" tabindex="-1"><a class="header-anchor" href="#_3-3-使用-objdump-查看汇编代码"><span>3.3 使用 objdump 查看汇编代码</span></a></h4><h5 id="_3-3-1-使用dmesg-命令-找到发生段错误的地址" tabindex="-1"><a class="header-anchor" href="#_3-3-1-使用dmesg-命令-找到发生段错误的地址"><span>3.3.1 使用dmesg 命令，找到发生段错误的地址</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[7612082.776055] test[11162]: segfault at 4005a0 ip 00000000004004fd sp 00007fffbe060180 error 7 in test[400000+1000]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>可知发生段错误的地址：4005a0，相对于的指令指针地址：00000000004004fd。</p><h5 id="_3-3-2-使用-objdump-生成二进制的相关信息-重定向到文件中" tabindex="-1"><a class="header-anchor" href="#_3-3-2-使用-objdump-生成二进制的相关信息-重定向到文件中"><span>3.3.2 使用 objdump 生成二进制的相关信息，重定向到文件中：</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>objdump -d ./test &gt; test_dump</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>生成的 test_dump 文件中包含了二进制文件 test 的汇编代码</p><h5 id="_3-3-3-在-test-dump-文件中查找发生段错误的地址" tabindex="-1"><a class="header-anchor" href="#_3-3-3-在-test-dump-文件中查找发生段错误的地址"><span>3.3.3 在 test_dump 文件中查找发生段错误的地址</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00000000004004c0</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">frame_dumm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">y</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">102</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004c0:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   48</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 83</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 3d</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 58</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 09</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 20</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    cmpq</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">   $0x0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">,0x200958</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%rip</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)        </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 600e20 &lt;__JCR_END__&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">103</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004c7:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   00</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">104</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004c8:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   74</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 1e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                   je</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     4004e8</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">frame_dummy+0x2</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">8&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">105</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004ca:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   b8</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">,%eax</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">106</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004cf:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   48</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 85</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> c0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                test</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   %rax,%rax</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">107</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004d2:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   74</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                   je</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     4004e8</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">frame_dummy+0x2</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">8&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">108</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004d4:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   55</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      push</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   %rbp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">109</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004d5:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   bf</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 20</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 0e</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 60</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    $0x600e20</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">,%edi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">110</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004da:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   48</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 89</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> e5</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                mov</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    %rsp,%rbp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">111</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004dd:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   ff</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> d0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                   callq</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">  *</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">%rax</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">112</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004df:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   5d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      pop</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    %rbp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">113</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004e0:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   e9</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 7b</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ff</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ff</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ff</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          jmpq</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   400460</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">register_tm_clone</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">s</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">114</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004e5:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   0f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 1f</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                nopl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">   (%rax)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">115</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004e8:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   e9</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 73</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ff</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ff</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ff</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          jmpq</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   400460</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">register_tm_clone</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">s</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">116</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">117</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 00000000004004ed</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">mai</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">118</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004ed:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   55</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      push</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   %rbp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">119</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004ee:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   48</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 89</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> e5</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                mov</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    %rsp,%rbp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">120</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004f1:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   48</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> c7</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 45</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> f8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> a0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 05</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 40</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    movq</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">   $0x4005a0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">,-0x8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%rbp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">121</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004f8:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   00</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">122</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004f9:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   48</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 8b</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 45</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> f8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">             mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    -0x8(%rbp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">),%rax</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">123</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   4004fd:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   c7</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 54</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 45</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 53</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 54</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       movl</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">   $0x54534554</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">124</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   400503:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   c6</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 40</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 04</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">             movb</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">   $0x0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">,0x4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">125</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   400507:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   5d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      pop</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    %rbp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">126</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   400508:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   c3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                      retq</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">127</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   400509:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   0f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 1f</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 80</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    nopl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   0x0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">%rax</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我截取了一段信息，可以看到段错误发生在 main 函数中这一句，<code>movl $0x54534554,(%rax)</code> 我们对应到相对的源码中，也就定位到段错误了。</p><p>注意：如果使用了 gcc 的编译优化选项参数 (-O1, -O2, -O3) 的话，生成的汇编指令将会被优化，汇编代码就会有些不同。</p><h4 id="_3-4-使用-catchsegv-获取段错误详细信息" tabindex="-1"><a class="header-anchor" href="#_3-4-使用-catchsegv-获取段错误详细信息"><span>3.4 使用 catchsegv 获取段错误详细信息</span></a></h4><p>这个命令专门用来处理段错误，他会打印出段错误的堆栈信息。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>*** Segmentation fault</span></span>
<span class="line"><span>Register dump:</span></span>
<span class="line"><span></span></span>
<span class="line"><span> RAX: 00000000004005a0   RBX: 0000000000000000   RCX: 0000000000400510</span></span>
<span class="line"><span> RDX: 00007ffd4612de18   RSI: 00007ffd4612de08   RDI: 0000000000000001</span></span>
<span class="line"><span> RBP: 00007ffd4612dd20   R8 : 00007fafea5bee80   R9 : 0000000000000000</span></span>
<span class="line"><span> R10: 00007ffd4612d860   R11: 00007fafea217480   R12: 0000000000400400</span></span>
<span class="line"><span> R13: 00007ffd4612de00   R14: 0000000000000000   R15: 0000000000000000</span></span>
<span class="line"><span> RSP: 00007ffd4612dd20</span></span>
<span class="line"><span></span></span>
<span class="line"><span> RIP: 00000000004004fd   EFLAGS: 00010246</span></span>
<span class="line"><span></span></span>
<span class="line"><span> CS: 0033   FS: 0000   GS: 0000</span></span>
<span class="line"><span></span></span>
<span class="line"><span> Trap: 0000000e   Error: 00000007   OldMask: 00000000   CR2: 004005a0</span></span>
<span class="line"><span></span></span>
<span class="line"><span> FPUCW: 0000037f   FPUSW: 00000000   TAG: 00000000</span></span>
<span class="line"><span> RIP: 00000000   RDP: 00000000</span></span>
<span class="line"><span></span></span>
<span class="line"><span> ST(0) 0000 0000000000000000   ST(1) 0000 0000000000000000</span></span>
<span class="line"><span> ST(2) 0000 0000000000000000   ST(3) 0000 0000000000000000</span></span>
<span class="line"><span> ST(4) 0000 0000000000000000   ST(5) 0000 0000000000000000</span></span>
<span class="line"><span> ST(6) 0000 0000000000000000   ST(7) 0000 0000000000000000</span></span>
<span class="line"><span> mxcsr: 1f80</span></span>
<span class="line"><span> XMM0:  00000000000000000000000000000000 XMM1:  00000000000000000000000000000000</span></span>
<span class="line"><span> XMM2:  00000000000000000000000000000000 XMM3:  00000000000000000000000000000000</span></span>
<span class="line"><span> XMM4:  00000000000000000000000000000000 XMM5:  00000000000000000000000000000000</span></span>
<span class="line"><span> XMM6:  00000000000000000000000000000000 XMM7:  00000000000000000000000000000000</span></span>
<span class="line"><span> XMM8:  00000000000000000000000000000000 XMM9:  00000000000000000000000000000000</span></span>
<span class="line"><span> XMM10: 00000000000000000000000000000000 XMM11: 00000000000000000000000000000000</span></span>
<span class="line"><span> XMM12: 00000000000000000000000000000000 XMM13: 00000000000000000000000000000000</span></span>
<span class="line"><span> XMM14: 00000000000000000000000000000000 XMM15: 00000000000000000000000000000000</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Backtrace:</span></span>
<span class="line"><span>/data/home/noahyzhang/test_linux/core/test.c:13(main)[0x4004fd]</span></span>
<span class="line"><span>/lib64/libc.so.6(__libc_start_main+0xf5)[0x7fafea217575]</span></span>
<span class="line"><span>??:?(_start)[0x400429]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Memory map:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>00400000-00401000 r-xp 00000000 fc:11 1839082 /data/home/noahyzhang/test_linux/core/test</span></span>
<span class="line"><span>00600000-00601000 r--p 00000000 fc:11 1839082 /data/home/noahyzhang/test_linux/core/test</span></span>
<span class="line"><span>00601000-00602000 rw-p 00001000 fc:11 1839082 /data/home/noahyzhang/test_linux/core/test</span></span>
<span class="line"><span>02554000-02579000 rw-p 00000000 00:00 0 [heap]</span></span>
<span class="line"><span>7fafe9ddb000-7fafe9df0000 r-xp 00000000 fc:01 5194 /usr/lib64/libgcc_s-4.8.5-20150702.so.1</span></span>
<span class="line"><span>7fafe9df0000-7fafe9fef000 ---p 00015000 fc:01 5194 /usr/lib64/libgcc_s-4.8.5-20150702.so.1</span></span>
<span class="line"><span>7fafe9fef000-7fafe9ff0000 r--p 00014000 fc:01 5194 /usr/lib64/libgcc_s-4.8.5-20150702.so.1</span></span>
<span class="line"><span>7fafe9ff0000-7fafe9ff1000 rw-p 00015000 fc:01 5194 /usr/lib64/libgcc_s-4.8.5-20150702.so.1</span></span>
<span class="line"><span>7fafe9ff1000-7fafe9ff3000 r-xp 00000000 fc:01 25105 /usr/lib64/libdl-2.17.so</span></span>
<span class="line"><span>7fafe9ff3000-7fafea1f3000 ---p 00002000 fc:01 25105 /usr/lib64/libdl-2.17.so</span></span>
<span class="line"><span>7fafea1f3000-7fafea1f4000 r--p 00002000 fc:01 25105 /usr/lib64/libdl-2.17.so</span></span>
<span class="line"><span>7fafea1f4000-7fafea1f5000 rw-p 00003000 fc:01 25105 /usr/lib64/libdl-2.17.so</span></span>
<span class="line"><span>7fafea1f5000-7fafea3ba000 r-xp 00000000 fc:01 24989 /usr/lib64/libc-2.17.so</span></span>
<span class="line"><span>7fafea3ba000-7fafea5b9000 ---p 001c5000 fc:01 24989 /usr/lib64/libc-2.17.so</span></span>
<span class="line"><span>7fafea5b9000-7fafea5bd000 r--p 001c4000 fc:01 24989 /usr/lib64/libc-2.17.so</span></span>
<span class="line"><span>7fafea5bd000-7fafea5bf000 rw-p 001c8000 fc:01 24989 /usr/lib64/libc-2.17.so</span></span>
<span class="line"><span>7fafea5bf000-7fafea5c4000 rw-p 00000000 00:00 0</span></span>
<span class="line"><span>7fafea5c4000-7fafea5c8000 r-xp 00000000 fc:01 24881 /usr/lib64/libSegFault.so</span></span>
<span class="line"><span>7fafea5c8000-7fafea7c7000 ---p 00004000 fc:01 24881 /usr/lib64/libSegFault.so</span></span>
<span class="line"><span>7fafea7c7000-7fafea7c8000 r--p 00003000 fc:01 24881 /usr/lib64/libSegFault.so</span></span>
<span class="line"><span>7fafea7c8000-7fafea7c9000 rw-p 00004000 fc:01 24881 /usr/lib64/libSegFault.so</span></span>
<span class="line"><span>7fafea7c9000-7fafea7eb000 r-xp 00000000 fc:01 4899 /usr/lib64/ld-2.17.so</span></span>
<span class="line"><span>7fafea8ca000-7fafea8cc000 rw-p 00000000 00:00 0</span></span>
<span class="line"><span>7fafea8e1000-7fafea8e4000 r-xp 00000000 fc:01 25620 /usr/lib64/libonion_security.so.1.0.19</span></span>
<span class="line"><span>7fafea8e4000-7fafea9e4000 ---p 00003000 fc:01 25620 /usr/lib64/libonion_security.so.1.0.19</span></span>
<span class="line"><span>7fafea9e4000-7fafea9e5000 rw-p 00003000 fc:01 25620 /usr/lib64/libonion_security.so.1.0.19</span></span>
<span class="line"><span>7fafea9e5000-7fafea9e9000 rw-p 00000000 00:00 0</span></span>
<span class="line"><span>7fafea9e9000-7fafea9ea000 rw-p 00000000 00:00 0</span></span>
<span class="line"><span>7fafea9ea000-7fafea9eb000 r--p 00021000 fc:01 4899 /usr/lib64/ld-2.17.so</span></span>
<span class="line"><span>7fafea9eb000-7fafea9ec000 rw-p 00022000 fc:01 4899 /usr/lib64/ld-2.17.so</span></span>
<span class="line"><span>7fafea9ec000-7fafea9ed000 rw-p 00000000 00:00 0</span></span>
<span class="line"><span>7ffd4610e000-7ffd4612f000 rw-p 00000000 00:00 0 [stack]</span></span>
<span class="line"><span>7ffd4618e000-7ffd46190000 r-xp 00000000 00:00 0 [vdso]</span></span>
<span class="line"><span>ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0 [vsyscall]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以在 Backtrace 中看到 <code> /data/home/noahyzhang/test_linux/core/test.c:13(main)[0x4004fd]</code>，发现提示错误发生在 test.c 的13行。并且给出了指针指令地址。</p><h4 id="_3-5-其他关于段错误的工具" tabindex="-1"><a class="header-anchor" href="#_3-5-其他关于段错误的工具"><span>3.5 其他关于段错误的工具</span></a></h4><h5 id="_3-5-1-ldd命令" tabindex="-1"><a class="header-anchor" href="#_3-5-1-ldd命令"><span>3.5.1 ldd命令</span></a></h5><p>ldd 命令可以查看二进制程序的共享库依赖，结果包括库的名称、起始地址等，这样就可以确定段错误到底是发生在自己写的程序中还是出现在共享库中。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>ldd ./test</span></span>
<span class="line"><span>        linux-vdso.so.1 =&gt;  (0x00007fff7a5f4000)</span></span>
<span class="line"><span>        /$LIB/libonion.so =&gt; /lib64/libonion.so (0x00007ff00455c000)</span></span>
<span class="line"><span>        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007ff004074000)</span></span>
<span class="line"><span>        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007ff003e70000)</span></span>
<span class="line"><span>        /lib64/ld-linux-x86-64.so.2 (0x00007ff004443000)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-5-2-日志" tabindex="-1"><a class="header-anchor" href="#_3-5-2-日志"><span>3.5.2 日志</span></a></h5><p>其实我们在写代码的时候，加上适当的日志是非常有必要的，这种查看错误的办法是最简单高效的。</p><p>为了减少代码编译后的二进制文件大小，我们可以使用条件编译指令 <code>#ifdef DEBUG 、#endif </code>等把 print 打印函数包起来。这样在程序编译的时候，加上 -DEBUG 参数就可以查看调试信息，不加就不会显示调试信息。这样做可以快速定位问题，也能避免二进制文件大的问题。</p><h2 id="_4-规避一些问题" tabindex="-1"><a class="header-anchor" href="#_4-规避一些问题"><span>4. 规避一些问题</span></a></h2><ol><li><p>出现段错误时，首先应该想到段错误的定义，从它出发考虑引发错误的原因。</p></li><li><p>在使用指针时，定义了指针后记得初始化指针，在使用的时候记得判断是否为NULL。</p></li><li><p>在使用数组时，注意数组是否被初始化，数组下标是否越界，数组元素是否存在等。</p></li><li><p>在访问变量时，注意变量所占地址空间是否已经被程序释放掉。</p></li><li><p>在处理变量时，注意变量的格式控制是否合理等。</p></li><li><p>尽量不要写递归函数，会占用大量的栈空间。</p></li></ol>`,55)]))}const d=i(l,[["render",p],["__file","3.linux下段错误的产生原因及调试方法.html.vue"]]),r=JSON.parse('{"path":"/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/3.linux%E4%B8%8B%E6%AE%B5%E9%94%99%E8%AF%AF%E7%9A%84%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0%E5%8F%8A%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95.html","title":"3.linux下段错误的产生原因及调试方法","lang":"zh-CN","frontmatter":{"title":"3.linux下段错误的产生原因及调试方法","date":"2020-10-25T17:11:41.000Z","tags":["段错误 core"],"description":"linux下 c/c++ 编程最常见的就是错误就是段错误了，本文来分析一下段错误为什么产生？产生的原因以及如何处理。 1. 段错误介绍 分段错误(通常简称段错误)是计算机软件运行过程中可能出现的一种特殊的错误情况。简而言之,出现段错误当一个程序试图访问不允许访问的内存位置,或试图访问一个内存位置的方式是不允许的(例如,试图写一个只读的位置,或覆盖操作系...","head":[["meta",{"property":"og:url","content":"https://noahyz.github.io/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/3.linux%E4%B8%8B%E6%AE%B5%E9%94%99%E8%AF%AF%E7%9A%84%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0%E5%8F%8A%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95.html"}],["meta",{"property":"og:site_name","content":"noahyz的博客"}],["meta",{"property":"og:title","content":"3.linux下段错误的产生原因及调试方法"}],["meta",{"property":"og:description","content":"linux下 c/c++ 编程最常见的就是错误就是段错误了，本文来分析一下段错误为什么产生？产生的原因以及如何处理。 1. 段错误介绍 分段错误(通常简称段错误)是计算机软件运行过程中可能出现的一种特殊的错误情况。简而言之,出现段错误当一个程序试图访问不允许访问的内存位置,或试图访问一个内存位置的方式是不允许的(例如,试图写一个只读的位置,或覆盖操作系..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"noahyz"}],["meta",{"property":"article:tag","content":"段错误 core"}],["meta",{"property":"article:published_time","content":"2020-10-25T17:11:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"3.linux下段错误的产生原因及调试方法\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2020-10-25T17:11:41.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"noahyz\\",\\"url\\":\\"/about-the-author/\\"}]}"]]},"headers":[{"level":2,"title":"1. 段错误介绍","slug":"_1-段错误介绍","link":"#_1-段错误介绍","children":[]},{"level":2,"title":"2. 为什么产生段错误","slug":"_2-为什么产生段错误","link":"#_2-为什么产生段错误","children":[]},{"level":2,"title":"3. 查看段错误信息","slug":"_3-查看段错误信息","link":"#_3-查看段错误信息","children":[]},{"level":2,"title":"4. 规避一些问题","slug":"_4-规避一些问题","link":"#_4-规避一些问题","children":[]}],"git":{},"readingTime":{"minutes":8.82,"words":2647},"filePathRelative":"操作系统/问题排查/3.linux下段错误的产生原因及调试方法.md","localizedDate":"2020年10月26日","excerpt":"<p>linux下 c/c++ 编程最常见的就是错误就是段错误了，本文来分析一下段错误为什么产生？产生的原因以及如何处理。</p>\\n<h2>1. 段错误介绍</h2>\\n<div class=\\"language- line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"\\" data-title=\\"\\" style=\\"--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes github-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>A segmentation fault (often shortened to segfault) is a particular error condition that can occur during the operation of computer software. In short, a segmentation fault occurs when a program attempts to access a memory location that it is not allowed to access, or attempts to access a memory location in a way that is not allowed (e.g., attempts to write to a read-only location, or to overwrite part of the operating system). Systems based on processors like the Motorola 68000 tend to refer to these events as Address or Bus errors.</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>Segmentation is one approach to memory management and protection in the operating system. It has been superseded by paging for most purposes, but much of the terminology of segmentation is still used, \\"segmentation fault\\" being an example. Some operating systems still have segmentation at some logical level although paging is used as the main memory management policy.</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span>On Unix-like operating systems, a process that accesses invalid memory receives the SIGSEGV signal. On Microsoft Windows, a process that accesses invalid memory receives the STATUS_ACCESS_VIOLATION exception.</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{d as comp,r as data};
