import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,a,o as l}from"./app-D1zlwylF.js";const e={};function t(h,i){return l(),n("div",null,i[0]||(i[0]=[a(`<h2 id="linux-之-syslog-日志服务详解" tabindex="-1"><a class="header-anchor" href="#linux-之-syslog-日志服务详解"><span>Linux 之 syslog 日志服务详解</span></a></h2><p>syslog 和 rsyslog 是 Linux 下默认的日志守护进程。rsyslog 是 syslog 的升级版。同时 syslog 是标准协议，可以用来记录设备的日志。在UNIX系统，路由器、交换机等网络设备中，系统日志(System Log)记录系统中任何时间发生的大小事件。管理者可以通过查看系统记录，随时掌握系统状况。UNIX的系统日志是通过syslogd这个进程记录系统有关事件记录，也可以记录应用程序运作事件。通过适当的配置，我们还可以实现运行syslog协议的机器间通信，通过分析这些网络行为日志，藉以追踪掌握与设备和网络有关的状况。</p><h2 id="一、syslog的配置文件" tabindex="-1"><a class="header-anchor" href="#一、syslog的配置文件"><span>一、syslog的配置文件</span></a></h2><p>想要整体了解syslog，先从syslog的配置文件开始看起。 /etc/rsyslog.conf 是 rsyslog 守护进程启动时需要的配置文件。各版本内容有略微不同，但是整体大致都相同。</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># rsyslog configuration file</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># For more information see /usr/share/doc/rsyslog-*/rsyslog_conf.html</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># If you experience problems, see http://www.rsyslog.com/doc/troubleshoot.html</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#### MODULES ####</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 加载模块</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># The imjournal module bellow is now used as a message source instead of imuxsock.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 加载 imuxsock 模块，为本地系统登陆提供支持(例如通过logger命令)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$ModLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> imuxsock </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># provides support for local system logging (e.g. via logger command)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 提供对systemd日志的访问</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$ModLoad</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> imjournal </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># provides access to the systemd journal</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 加载 imklog，为内核登陆提供支持</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$ModLoad imklog # reads kernel messages (the same are read from journald)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 提供标记信息功能</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$ModLoad immark  # provides --MARK-- message capability</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 加载 UDP 模块，允许使用UDP的514端口接收采用UDP协议转发的日志</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Provides UDP syslog reception</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$ModLoad imudp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$UDPServerRun 514</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 加载 TCP 模块，允许使用TCP的514端口接收采用TCP协议转发的日志</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Provides TCP syslog reception</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$ModLoad imtcp</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$InputTCPServerRun 514</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#### GLOBAL DIRECTIVES ####</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 全局指令的配置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Where to place auxiliary files</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 辅助文件目录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$WorkDirectory</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /var/lib/rsyslog</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Use default timestamp format</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 使用默认的时间戳格式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$ActionFileDefaultTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> RSYSLOG_TraditionalFileFormat</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># File syncing capability is disabled by default. This feature is usually not required,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># not useful and an extreme performance hit</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 文件同步功能，通常是被禁用的，这个功能通常不是必要的，会大幅影响性能</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$ActionFileEnableSync on</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Include all config files in /etc/rsyslog.d/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 包含配置文件的目录，这个目录下的配置文件也是生效的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$IncludeConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /etc/rsyslog.d/</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Turn off message reception via local log socket;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># local messages are retrieved through imjournal now.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 通过本地消息日志套接字关闭消息接收，本地消息可以用imjournal检索</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$OmitLocalLogging</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> on</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># File to store the position in the journal</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 在日志中文件用于存储的位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$IMJournalStateFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> imjournal.state</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#### RULES ####</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#RULES部分主要是对各种facility和level进行设置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#设置你想要接收的facility的何种level的日志消息</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Log all kernel messages to the console.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Logging much else clutters up the screen.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 将将所有的内核日志记录在界面，会造成屏幕混乱</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#kern.*                                                 /dev/console</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Log anything (except mail) of level info or higher.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Don&#39;t log private authentication messages!</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 将 info或者更高级别的消息送到这个文件，除了mail以外</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 其中 * 是通配符，代表任何设备，none表示不对任何级别的信息进行记录</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 同一行配置中，允许出现多个选择条件，多个选择条件使用 ; 隔开</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.info;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mail.none</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">authpriv.none</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cron.none</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                /var/log/messages</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># The authpriv file has restricted access.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 将 authpriv 设备的任何级别信息记录到这个文件中，这主要是一些权限相关的信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">authpriv.*</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                              /var/log/secure</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Log all the mail messages in one place.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 将 mail 设备中的任何级别的信息记录到这个文件，这主要是和电子邮件相关的信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 文件前的前缀表示可以避免日志的同步写入，某些时候对提升系统的性能有很大的帮助</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mail.*</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">                                                  -/var/log/maillog</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Log cron stuff</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 将 cron 设备中的任何级别的信息记录到这个文件，这主要是系统中定期执行的任务相关信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cron.*</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                  /var/log/cron</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Everybody gets emergency messages</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 将任何级别的 emerg 级别的信息发送给所有正在系统上的用户</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.emerg                                                 :omusrmsg:</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Save news errors of level crit and higher in a special file.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># uucp 和 news 设备的 crit 级别的信息记录到这个文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">uucp,news.crit</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                          /var/log/spooler</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Save boot messages also to boot.log</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 将系统启动相关的信息记录在这个文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">local7.*</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                /var/log/boot.log</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># ### begin forwarding rule ###</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 转发规则</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># The statement between the begin ... end define a SINGLE forwarding</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># rule. They belong together, do NOT split them. If you create multiple</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># forwarding rules, duplicate the whole block!</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 远程日志可以使用 TCP 保持可靠</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># Remote Logging (we use TCP for reliable delivery)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 创建一个磁盘上的队列，如果远程的主机是关闭的状态，消息会先存储在磁盘中并且在远程主机启动时发送过去(TCP)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># An on-disk queue is created for this action. If the remote host is</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># down, messages are spooled to disk and sent when it is up again.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># spool 文件 唯一的前缀</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$ActionQueueFileName fwdRule1 # unique name prefix for spool files</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 1gb的空间限制(尽量使用)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$ActionQueueMaxDiskSpace 1g   # 1gb space limit (use as much as possible)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 在关机的时候把信息存储在磁盘中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$ActionQueueSaveOnShutdown on # save messages to disk on shutdown</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 异步运行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$ActionQueueType LinkedList   # run asynchronously</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 如果远程主机宕机，将无限次重试</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#$ActionResumeRetryCount -1    # infinite retries if host is down</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 远程的主机和端口,注意：若用UDP传输，则将@@改为@即可。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#*.* @@remote-host:514</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># ### end of the forwarding rule ###</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>/etc/rsyslog.conf 的修改只是在 rsyslog 守护进程重新启动后才会生效。</p><p>该文件由不同程序或者消息分类的单个条目组成，每个占一行，对每类消息提供一个选择域和一个动作域。这些域由 tab 隔开：</p><ul><li>选择域指明消息的类型和优先级</li><li>动作域指明 syslog 接收到一个与选择标准相匹配的消息时所执行的动作。</li></ul><table><thead><tr><th>消息类型</th><th>消息来源</th></tr></thead><tbody><tr><td>kern</td><td>内核</td></tr><tr><td>user</td><td>用户程序</td></tr><tr><td>Damon</td><td>系统守护进程</td></tr><tr><td>Mail</td><td>电子邮件系统</td></tr><tr><td>Auth</td><td>与安全权限相关的命令</td></tr><tr><td>Lpr</td><td>打印机</td></tr><tr><td>News</td><td>新闻组信息</td></tr><tr><td>Uucp</td><td>Uucp程序</td></tr><tr><td>Cron</td><td>记录当前登陆的每个用户信息</td></tr><tr><td>wtmp</td><td>一个用户每次登陆进入和退出时间的永久记录</td></tr><tr><td>Authpriv</td><td>授权信息</td></tr></tbody></table><table><thead><tr><th>优先级</th><th>描述</th></tr></thead><tbody><tr><td>emerg</td><td>最高的紧急程度状态</td></tr><tr><td>alert</td><td>紧急状态</td></tr><tr><td>Cirt</td><td>重要信息</td></tr><tr><td>Warning</td><td>警告</td></tr><tr><td>err</td><td>临界状态</td></tr><tr><td>notice</td><td>出现不寻常的事情</td></tr><tr><td>info</td><td>一般性消息</td></tr><tr><td>Debug</td><td>调试级信息</td></tr><tr><td>None</td><td>不记录任何日志信息</td></tr></tbody></table><p>rsyslog 还有一个启动选项。在 /etc/sysconfig/rsyslog 里面，但是从rsysconfig v3就不推荐使用了，如果要使用，可以加上选项 -c2。</p><ul><li>-r：将当前主机作为日志服务器，监听514端口上进来的UDP包，接收远程系统的信息。没有该选项，将不会接收来自远程系统的信息。</li><li>-m **：将默认的时间戳标记信息出现频率变为自己指定的值【eg： -m240，表示每240分钟在日志文件中增加一行时间戳消息】</li><li>-x：表示不希望让中央日志服务器解析其他机器的FQDN（完全合格域名，指的是主机名+全路径）</li></ul><p>例如：SYSLOGD_OPTIONS=&quot;-r -x -m 240 -c 5&quot;</p><h2 id="二、syslog-协议" tabindex="-1"><a class="header-anchor" href="#二、syslog-协议"><span>二、syslog 协议</span></a></h2><p>Syslog协议[2]是一种用来在互联网协议（TCP/IP）的网络中传递记录档讯息的标准，属于一种主从式协议：syslog发送端发送一条文字信息到syslog接收端。</p><p>syslog消息格式：syslog消息主要分为 Priority、Head和Message三个部分</p><h5 id="_1-priority" tabindex="-1"><a class="header-anchor" href="#_1-priority"><span>1. Priority</span></a></h5><h5 id="其中priority是由两个部分组成-facility、level" tabindex="-1"><a class="header-anchor" href="#其中priority是由两个部分组成-facility、level"><span>其中Priority是由两个部分组成---Facility、Level</span></a></h5><ul><li>Facility表明该日志消息是由谁产生的，是内核kern？还是用户user？又或是邮件mail？不同的facility对应不同的代号，可通过man 3 syslog查看：</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>LOG_AUTHPRIV          security/authorization messages (private)</span></span>
<span class="line"><span>LOG_CRON              clock daemon (cron and at)</span></span>
<span class="line"><span>LOG_DAEMON            system daemons without separate facility value</span></span>
<span class="line"><span>LOG_FTP               ftp daemon</span></span>
<span class="line"><span>LOG_KERN              kernel messages (these can’t be generated from user processes)</span></span>
<span class="line"><span>LOG_LOCAL0 through LOG_LOCAL7		reserved for local use</span></span>
<span class="line"><span>LOG_LPR               line printer subsystem</span></span>
<span class="line"><span>LOG_MAIL              mail subsystem</span></span>
<span class="line"><span>LOG_NEWS              USENET news subsystem</span></span>
<span class="line"><span>LOG_SYSLOG            messages generated internally by syslogd(8)</span></span>
<span class="line"><span>LOG_USER (default)    generic user-level messages</span></span>
<span class="line"><span>LOG_UUCP              UUCP subsystem</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Level表明该日志消息的重要程度，是导致系统不能正常使用了的紧急级别emerg？还是需要被及时处理的警告级别alert？又或仅仅是需要调试的debug级别的信息？同样可通过man 3 syslog查看：</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>LOG_EMERG      system is unusable</span></span>
<span class="line"><span>LOG_ALERT      action must be taken immediately</span></span>
<span class="line"><span>LOG_CRIT       critical conditions</span></span>
<span class="line"><span>LOG_ERR        error conditions</span></span>
<span class="line"><span>LOG_WARNING    warning conditions</span></span>
<span class="line"><span>LOG_NOTICE     normal, but significant, condition</span></span>
<span class="line"><span>LOG_INFO       informational message</span></span>
<span class="line"><span>LOG_DEBUG      debug-level message</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Facility和level分别定义了不同的代号，其各自的宏定义可见/usr/include/sys/syslog.h头文件，它们两者的组合构成了Priority头的值。而该priority的值也恰恰是syslog函数的第一个参数的值。</p><h5 id="_2、head" tabindex="-1"><a class="header-anchor" href="#_2、head"><span>2、Head</span></a></h5><p>包括 时间戳、Host等等</p><h5 id="_3、message" tabindex="-1"><a class="header-anchor" href="#_3、message"><span>3、Message</span></a></h5><p>消息内容</p><h2 id="三、使用syslog接口调用syslog服务" tabindex="-1"><a class="header-anchor" href="#三、使用syslog接口调用syslog服务"><span>三、使用syslog接口调用syslog服务</span></a></h2><h4 id="_1、syslog-api" tabindex="-1"><a class="header-anchor" href="#_1、syslog-api"><span>1、syslog API</span></a></h4><p>linux C 中提供了一套系统日志写入的接口，主要涉及三个函数openlog，syslog，closelog。</p><ul><li><p>打开一个syslog连接</p><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" data-title="c++" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;syslog.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> openlog</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">ident</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> option</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> facility</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>参数：</p><ul><li><p>ident 指定的字符串会放入到相应的消息日志中</p></li><li><p>option有如下选项</p></li></ul><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">LOG_CONS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              Write</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> directly</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> console</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> if</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> there</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> an</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> error</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> while</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sending</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logger.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">LOG_NDELAY</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            Open</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> connection</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> immediately</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">LOG_NOWAIT</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            Don’t</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  wait</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> child</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> processes</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> that</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> may</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> have</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> been</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> created</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> while</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logging</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> message.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">LOG_ODELAY</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            The</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> converse</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> LOG_NDELAY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">opening</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> connection</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> delayed</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> until</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> syslog</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> called.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">LOG_PERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            (Not </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> POSIX.1-2001.</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)  Print to stderr as well.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">LOG_PID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">               Include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> each</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> message.打印的每一条日志信息包含当前进程的PID</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>facility 上面介绍了，下面是常用选项</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>LOG_USER：打印的每一条日志信息包含当前用户的等级信息</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>产生一条日志消息以特定的规则分发出去</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#include &lt;syslog.h&gt;</span></span>
<span class="line"><span>void syslog(int priority, const char *format, ...);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>参数:</p><ul><li>priority 优先级，由facility和level的或运算组成；</li><li>format 格式化输出，类似于printf函数中的format参数。</li></ul></li><li><p>关闭用来写日志记录的文件描述符</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#include &lt;syslog.h&gt;</span></span>
<span class="line"><span>void closelog(void);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_2、一个简单的syslog例子" tabindex="-1"><a class="header-anchor" href="#_2、一个简单的syslog例子"><span>2、一个简单的syslog例子</span></a></h4><div class="language-c++ line-numbers-mode" data-highlighter="shiki" data-ext="c++" data-title="c++" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;syslog.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">char*</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> argv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    openlog</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">],LOG_CONS </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> LOG_PID, LOG_USER);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> count </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        syslog</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(LOG_INFO, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">, log info test ...&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, count);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        count</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      	sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    closelog</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 rsyslog 配置文件中添加一行内容如下</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>user.*			/var/log/user_message.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>重启 rsyslog 服务 systemctl restart rsyslog</p><p>执行这个syslog 例子。</p><p>cat user_message.log 就可以看到发送的消息内容</p><h2 id="其他" tabindex="-1"><a class="header-anchor" href="#其他"><span>其他</span></a></h2><p>扩展：也可以将这台机器上syslog日志发送到另一台机器的syslog进程并存储起来，只需要配置一下即可</p><p>注意：重点是学习syslog的配置文件，搞清楚系统日志，便于我们查找系统问题。</p><p>Linux下的syslog，它出现的目的并不是为了提供用户每个进程的日志输出，syslog只是用来作为对于服务管理的整套机制，它针对的是一类服务，用来做日志服务器，实现对整个系统网络中日志的维护（对日志的维护，实际上就是对整个计算机群的维护）。同时，真正的工程中，并不会使用syslog作为全套的日志管理工具，在Linux下有提供了很多完整的日志库工具，比如log4cplus、zlog等。</p>`,42)]))}const r=s(e,[["render",t],["__file","Linux之syslog日志服务详解.html.vue"]]),d=JSON.parse('{"path":"/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/Linux%E4%B9%8Bsyslog%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E8%AF%A6%E8%A7%A3.html","title":"Linux之syslog日志服务详解","lang":"zh-CN","frontmatter":{"title":"Linux之syslog日志服务详解","date":"2020-12-03T19:11:41.000Z","tags":["syslog日志服务"],"description":"Linux 之 syslog 日志服务详解 syslog 和 rsyslog 是 Linux 下默认的日志守护进程。rsyslog 是 syslog 的升级版。同时 syslog 是标准协议，可以用来记录设备的日志。在UNIX系统，路由器、交换机等网络设备中，系统日志(System Log)记录系统中任何时间发生的大小事件。管理者可以通过查看系统记录，...","head":[["meta",{"property":"og:url","content":"https://noahyz.github.io/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/Linux%E4%B9%8Bsyslog%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1%E8%AF%A6%E8%A7%A3.html"}],["meta",{"property":"og:site_name","content":"noahyz的博客"}],["meta",{"property":"og:title","content":"Linux之syslog日志服务详解"}],["meta",{"property":"og:description","content":"Linux 之 syslog 日志服务详解 syslog 和 rsyslog 是 Linux 下默认的日志守护进程。rsyslog 是 syslog 的升级版。同时 syslog 是标准协议，可以用来记录设备的日志。在UNIX系统，路由器、交换机等网络设备中，系统日志(System Log)记录系统中任何时间发生的大小事件。管理者可以通过查看系统记录，..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"noahyz"}],["meta",{"property":"article:tag","content":"syslog日志服务"}],["meta",{"property":"article:published_time","content":"2020-12-03T19:11:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Linux之syslog日志服务详解\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2020-12-03T19:11:41.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"noahyz\\",\\"url\\":\\"/about-the-author/\\"}]}"]]},"headers":[{"level":2,"title":"Linux 之 syslog 日志服务详解","slug":"linux-之-syslog-日志服务详解","link":"#linux-之-syslog-日志服务详解","children":[]},{"level":2,"title":"一、syslog的配置文件","slug":"一、syslog的配置文件","link":"#一、syslog的配置文件","children":[]},{"level":2,"title":"二、syslog 协议","slug":"二、syslog-协议","link":"#二、syslog-协议","children":[]},{"level":2,"title":"三、使用syslog接口调用syslog服务","slug":"三、使用syslog接口调用syslog服务","link":"#三、使用syslog接口调用syslog服务","children":[]},{"level":2,"title":"其他","slug":"其他","link":"#其他","children":[]}],"git":{},"readingTime":{"minutes":9.33,"words":2799},"filePathRelative":"操作系统/系统编程/Linux之syslog日志服务详解.md","localizedDate":"2020年12月4日","excerpt":"<h2>Linux 之 syslog 日志服务详解</h2>\\n<p>syslog 和 rsyslog 是 Linux 下默认的日志守护进程。rsyslog 是 syslog 的升级版。同时 syslog 是标准协议，可以用来记录设备的日志。在UNIX系统，路由器、交换机等网络设备中，系统日志(System Log)记录系统中任何时间发生的大小事件。管理者可以通过查看系统记录，随时掌握系统状况。UNIX的系统日志是通过syslogd这个进程记录系统有关事件记录，也可以记录应用程序运作事件。通过适当的配置，我们还可以实现运行syslog协议的机器间通信，通过分析这些网络行为日志，藉以追踪掌握与设备和网络有关的状况。</p>","autoDesc":true}');export{r as comp,d as data};
